# ipv4  

![ipv4数据报格式](https://github.com/781303842/Mainstudy/blob/master/ALLIMG/ipv4%E6%95%B0%E6%8D%AE%E6%8A%A5%E6%A0%BC%E5%BC%8F.png)  

- 版本：ip协议的版本。 
- 首部长度：一般为4个字节
- 总长度：首部和数据的总长度，以太网的最长字节数为1500,字节，因此数据报的总长度不能超过这个。
- 标识：每产生一个数据包就+1，不是序号，当数据包长度超过MTU的时候，就需要分片，每个数据包片都复制一个标识，同一个数据报分片后的标志位都是一样的，方便后面组装。
- 标志：用来区分是否可以分片，以及后面是否还有分片的数据报。
- 片偏移： 分片后的数据相当于原数据报的位置，分片是以8字节为单位，因此偏移量也是。
- 首部校验和：只校验首部，不校验数据部分。
- 生存时间TTL：可通过路由的最大数量，到0的时候就会被丢弃，主要作用就是防止数据报在网络中循环。
- 协议：指出此分组携带的是那种协议，分别交由对应的传输层处理，如TCP好UDP。
- 源地址字段：发送方的IP地址。
- 目的地址：接收方的IP地址。  

2.网络层路由转发算法大致过程：（也许目的节点和源节点不在同一个网段，因此在查找的过程中应该是通过目的地址ip对应的ip类型对应的子网掩码求出网络所处段，如果子网掩码与目的ip与后的结果与路由表中某一个ip与
当前子网掩码与的结果相等，那就说通过这个路由器进行转发，一个路由器应该有多个网卡，处于多个不同的网段）
- 从数据报首部提出目的地址ip，D，得出目标网络地址为N，然后查找当前路由器的路由表
- 如果有此N与该路由器直接相连，则将数据报直接发送给D、
- 如果不相连，若有到达网络N的路由，则把数据包传输给下一跳的路由器
- 如果都没有，那就走默认路由地址
- 上面都没转发出去，那就转发出错。
